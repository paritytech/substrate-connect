<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@substrate/light-client-extension-helpers | Substrate Connect</title><meta name="description" content="Documentation for Substrate Connect"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">Substrate Connect</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../index.html">Substrate Connect</a></li><li><a href="_substrate_light_client_extension_helpers.html">@substrate/light-client-extension-helpers</a></li></ul><h1>Module @substrate/light-client-extension-helpers</h1></div><section class="tsd-panel tsd-typography"><p><br /><br /></p>
<div align="center">
  <h1 align="center">@substrate/light-client-extension-helpers</h1>
  <p align="center">
    <a href="https://www.npmjs.com/package/@substrate/light-client-extension-helpers">
      <img alt="npm" src="https://img.shields.io/npm/v/@substrate/light-client-extension-helpers" />
    </a>
    <a href="https://github.com/paritytech/substrate-connect/blob/master/LICENSE">
      <img alt="GPL-3.0-or-later" src="https://img.shields.io/npm/l/@substrate/light-client-extension-helpers" />
    </a>
  </p>
</div>

<p><br /><br /></p>
<a id="md:components" class="tsd-anchor"></a><h2><a href="#md:components">Components</a></h2><ul>
<li><strong>backgroundHelper</strong>: Manages the core logic running in the background, including Smoldot instance registration, chain synchronization, active connections, and communication with the content script.</li>
<li><strong>contentScriptHelper</strong>: Handles communication between the tab&#39;s webpage and the extension&#39;s background script.</li>
<li><strong>webPageHelper</strong>: Provides an interface for the tabâ€™s webpage to interact with the extension.</li>
<li><strong>extensionPagesHelper</strong>: A set of functions to manage persisted chains, connections, and boot-nodes within the extension page.</li>
<li><strong>smoldot</strong>: A thin abstraction over <a href="https://github.com/smol-dot/smoldot">smoldot</a> package that includes a <code>restart</code> method for the smoldot client</li>
</ul>
<a id="md:example-usage" class="tsd-anchor"></a><h2><a href="#md:example-usage">Example Usage</a></h2><a id="md:backgroundhelper" class="tsd-anchor"></a><h3><a href="#md:backgroundhelper">backgroundHelper</a></h3><p>The module exposes a <code>register</code> function that is meant to be called in your background
script. It does all the heavy lifting to manage your extension&#39;s connection to smoldot.</p>
<a id="md:how-you-can-use-it" class="tsd-anchor"></a><h4><a href="#md:how-you-can-use-it">How You Can Use It</a></h4><pre><code class="language-ts"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">register</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/background&quot;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-4">lightClientPageHelper</span><span class="hl-1">, </span><span class="hl-4">addOnAddChainByUserListener</span><span class="hl-1"> } = </span><span class="hl-0">register</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">smoldotClient:</span><span class="hl-1"> </span><span class="hl-0">start</span><span class="hl-1">({ </span><span class="hl-6">maxLogLevel:</span><span class="hl-1"> </span><span class="hl-8">4</span><span class="hl-1"> }),</span><br/><span class="hl-1">  </span><span class="hl-0">getWellKnownChainSpecs</span><span class="hl-6">:</span><span class="hl-1"> () </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-7">// these well known chains will be connected to when the extension is</span><br/><span class="hl-1">    </span><span class="hl-7">// started and their connection will always be maintained. The location</span><br/><span class="hl-1">    </span><span class="hl-7">// of these chainspecs is relative to your `assets` directory.</span><br/><span class="hl-1">    </span><span class="hl-12">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">      [</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;./chainspecs/polkadot.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;./chainspecs/ksmcc3.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;./chainspecs/westend2.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      ].</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-6">path</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-6">chrome</span><span class="hl-1">.</span><span class="hl-6">runtime</span><span class="hl-1">.</span><span class="hl-0">getURL</span><span class="hl-1">(</span><span class="hl-6">path</span><span class="hl-1">)).</span><span class="hl-0">then</span><span class="hl-1">((</span><span class="hl-6">response</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-6">response</span><span class="hl-1">.</span><span class="hl-0">text</span><span class="hl-1">()),</span><br/><span class="hl-1">      ),</span><br/><span class="hl-1">    ),</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">addOnAddChainByUserListener</span><span class="hl-1">(</span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-6">inputChain</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// listen for chain updates</span><br/><span class="hl-1">})</span>
</code><button>Copy</button></pre>
<a id="md:contentscripthelper" class="tsd-anchor"></a><h3><a href="#md:contentscripthelper">contentScriptHelper</a></h3><p>This module exposes a register function that should be called in your content
script. Once registered you can access the light client provider in your <code>inpage</code>
script.</p>
<p>This is useful if you are implementing the <a href="../discovery"><code>@substrate/discovery</code> protocol</a></p>
<a id="md:how-you-can-use-it-1" class="tsd-anchor"></a><h4><a href="#md:how-you-can-use-it-1">How You Can Use It</a></h4><pre><code class="language-ts"><span class="hl-7">// constants.ts</span><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">CHANNEL_ID</span><span class="hl-1"> = </span><span class="hl-2">&quot;substrate-wallet-template&quot;</span>
</code><button>Copy</button></pre>
<pre><code class="language-ts"><span class="hl-7">// content/index.ts</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">register</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/content-script&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">CHANNEL_ID</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;../constants&quot;</span><br/><br/><span class="hl-0">register</span><span class="hl-1">(</span><span class="hl-4">CHANNEL_ID</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<pre><code class="language-ts"><span class="hl-7">// inpage/index.ts</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">getLightClientProvider</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/web-page&quot;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">provider</span><span class="hl-1"> = </span><span class="hl-0">getLightClientProvider</span><span class="hl-1">(</span><span class="hl-4">CHANNEL_ID</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<a id="md:webpagehelper" class="tsd-anchor"></a><h3><a href="#md:webpagehelper">webPageHelper</a></h3><p>The webpage helper allows any dapp to discover the light client provider that
was registered using the <code>contentScriptHelper</code>. However this functionality
has been superseded by the <a href="../discovery">discovery protocol</a>.</p>
<a id="md:how-you-can-use-it-2" class="tsd-anchor"></a><h4><a href="#md:how-you-can-use-it-2">How You Can Use It</a></h4><pre><code class="language-ts"><span class="hl-7">// use-provider.ts</span><br/><span class="hl-5">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-6">LightClientProvider</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">getLightClientProvider</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/web-page&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">useEffect</span><span class="hl-1">, </span><span class="hl-6">useState</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;react&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">useIsMounted</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;./useIsMounted&quot;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">providers</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Map</span><span class="hl-1">&lt;</span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-12">Promise</span><span class="hl-1">&lt;</span><span class="hl-12">LightClientProvider</span><span class="hl-1">&gt;&gt;()</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">useLightClientProvider</span><span class="hl-1"> = (</span><span class="hl-6">channelId</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> [</span><span class="hl-4">provider</span><span class="hl-1">, </span><span class="hl-4">setProvider</span><span class="hl-1">] = </span><span class="hl-0">useState</span><span class="hl-1">&lt;</span><span class="hl-12">LightClientProvider</span><span class="hl-1">&gt;()</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">isMounted</span><span class="hl-1"> = </span><span class="hl-0">useIsMounted</span><span class="hl-1">()</span><br/><br/><span class="hl-1">  </span><span class="hl-0">useEffect</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-6">providers</span><span class="hl-1">.</span><span class="hl-0">has</span><span class="hl-1">(</span><span class="hl-6">channelId</span><span class="hl-1">))</span><br/><span class="hl-1">      </span><span class="hl-6">providers</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-6">channelId</span><span class="hl-1">, </span><span class="hl-0">getLightClientProvider</span><span class="hl-1">(</span><span class="hl-6">channelId</span><span class="hl-1">))</span><br/><span class="hl-1">    </span><span class="hl-6">providers</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-6">channelId</span><span class="hl-1">)?.</span><span class="hl-0">then</span><span class="hl-1">((</span><span class="hl-6">provider</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-0">isMounted</span><span class="hl-1">()) </span><span class="hl-5">return</span><br/><span class="hl-1">      </span><span class="hl-0">setProvider</span><span class="hl-1">(</span><span class="hl-6">provider</span><span class="hl-1">)</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  }, [</span><span class="hl-6">channelId</span><span class="hl-1">, </span><span class="hl-6">isMounted</span><span class="hl-1">])</span><br/><br/><span class="hl-1">  </span><span class="hl-5">return</span><span class="hl-1"> { </span><span class="hl-6">provider</span><span class="hl-1"> }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:extensionpageshelper" class="tsd-anchor"></a><h3><a href="#md:extensionpageshelper">extensionPagesHelper</a></h3><p>The extension page helper is conceptually the same as the web page helper,
except it is used in the user interface of your extension. By importing <code>helper</code>,
you can access light client functionality.</p>
<a id="md:how-you-can-use-it-3" class="tsd-anchor"></a><h4><a href="#md:how-you-can-use-it-3">How You Can Use It</a></h4><p>Get and set the bootnodes</p>
<pre><code class="language-ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">getBootNodes</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-6">chainId</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">  (</span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">helper</span><span class="hl-1">.</span><span class="hl-0">getChains</span><span class="hl-1">()).</span><span class="hl-0">find</span><span class="hl-1">(</span><br/><span class="hl-1">    ({ </span><span class="hl-6">genesisHash</span><span class="hl-1"> }) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-6">genesisHash</span><span class="hl-1"> === </span><span class="hl-6">wellKnownGenesisHashByChainId</span><span class="hl-1">[</span><span class="hl-6">chainId</span><span class="hl-1">],</span><br/><span class="hl-1">  )?.</span><span class="hl-6">bootNodes</span><span class="hl-1"> ?? []</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">setBootNodes</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-6">chainId</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-6">bootNodes</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">[]) </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">helper</span><span class="hl-1">.</span><span class="hl-0">setBootNodes</span><span class="hl-1">(</span><span class="hl-6">wellKnownGenesisHashByChainId</span><span class="hl-1">[</span><span class="hl-6">chainId</span><span class="hl-1">], </span><span class="hl-6">bootNodes</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>Decode call data</p>
<pre><code class="language-ts"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">getObservableClient</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@polkadot-api/observable-client&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">getViewBuilder</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@polkadot-api/view-builder&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">createClient</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@polkadot-api/substrate-client&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">helper</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/extension-page&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">filter</span><span class="hl-1">, </span><span class="hl-6">firstValueFrom</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;rxjs&quot;</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">decodeCallData</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-6">chainId</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-6">callData</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">chains</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">helper</span><span class="hl-1">.</span><span class="hl-0">getChains</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">chain</span><span class="hl-1"> = </span><span class="hl-6">chains</span><span class="hl-1">.</span><span class="hl-0">find</span><span class="hl-1">(({ </span><span class="hl-6">genesisHash</span><span class="hl-1"> }) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-6">genesisHash</span><span class="hl-1"> === </span><span class="hl-6">chainId</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-6">chain</span><span class="hl-1">) </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;unknown chain&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1"> = </span><span class="hl-0">getObservableClient</span><span class="hl-1">(</span><span class="hl-0">createClient</span><span class="hl-1">(</span><span class="hl-6">chain</span><span class="hl-1">.</span><span class="hl-6">provider</span><span class="hl-1">))</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-4">metadata$</span><span class="hl-1">, </span><span class="hl-4">unfollow</span><span class="hl-1"> } = </span><span class="hl-6">client</span><span class="hl-1">.</span><span class="hl-0">chainHead$</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">metadata</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">firstValueFrom</span><span class="hl-1">(</span><span class="hl-6">metadata$</span><span class="hl-1">.</span><span class="hl-0">pipe</span><span class="hl-1">(</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-6">Boolean</span><span class="hl-1">)))</span><br/><span class="hl-1">    </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-0">getViewBuilder</span><span class="hl-1">(</span><span class="hl-6">metadata</span><span class="hl-1">).</span><span class="hl-0">callDecoder</span><span class="hl-1">(</span><span class="hl-6">callData</span><span class="hl-1">)</span><br/><span class="hl-1">  } </span><span class="hl-5">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">unfollow</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-6">client</span><span class="hl-1">.</span><span class="hl-0">destroy</span><span class="hl-1">()</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:smoldot" class="tsd-anchor"></a><h3><a href="#md:smoldot">smoldot</a></h3><p>The <code>smoldot</code> package is a streamlined version of the original
<a href="https://github.com/smol-dot/smoldot">smoldot package</a>. Here are the key
differences:</p>
<ol>
<li><p><strong>Restarts</strong></p>
<p>The <code>smoldot</code> client now includes a <code>restart</code> method. This is useful for
restarting <code>smoldot</code> if it unexpectedly crashes, allowing you to quickly
fire up a new instance.</p>
</li>
<li><p><strong>Modified Add Chain Options</strong></p>
<p>When <code>smoldot</code> restarts, all prior connections made with <code>client.addChain</code>
are lost. To address this, the <code>AddChainOptions</code> has been modified. The
<code>potentialRelayChains</code> parameter is now a recursive <code>AddChainOptions</code> array
instead of a <code>Chain</code> array. This ensures that when <code>smoldot</code> restarts and
you need to call <code>addChain</code> to reconnect a parachain, the associated
relaychain is always reconnected first.</p>
</li>
<li><p><strong>Supervision</strong></p>
<p>This module also provides a <code>supervise</code> method, which checks the health of
<code>smoldot</code> and automatically invokes the <code>restart</code> method if it detects an
issue. It does this by repeatedly calling <code>addChain</code> with an empty string as
the chainspec parameter. If <code>addChain</code> throws an error that isn&#39;t an
<code>AddChainError</code>, it assumes <code>smoldot</code> is unhealthy and restarts it.</p>
</li>
</ol>
<hr>
<a id="md:how-you-can-use-it-4" class="tsd-anchor"></a><h4><a href="#md:how-you-can-use-it-4">How You Can Use It</a></h4><pre><code class="language-ts"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">start</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/smoldot&quot;</span><br/><br/><span class="hl-7">// Initialize the smoldot client</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1"> = </span><span class="hl-0">start</span><span class="hl-1">()</span><br/><br/><span class="hl-7">// Add a chain</span><br/><span class="hl-6">client</span><span class="hl-1">.</span><span class="hl-0">addChain</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-6">chainSpec:</span><span class="hl-1"> </span><span class="hl-2">&quot;...&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">potentialRelayChains:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-6">chainSpec:</span><span class="hl-1"> </span><span class="hl-2">&quot;...&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">potentialRelayChains:</span><span class="hl-1"> [], </span><span class="hl-7">// Recursive AddChainOptions array</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-0">supervise</span><span class="hl-1">(</span><span class="hl-6">client</span><span class="hl-1">, { </span><span class="hl-6">onError:</span><span class="hl-1"> </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-6">error</span><span class="hl-1"> })</span><br/><br/><span class="hl-7">// Supervise the client</span><br/><span class="hl-6">client</span><span class="hl-1">.</span><span class="hl-0">supervise</span><span class="hl-1">()</span>
</code><button>Copy</button></pre>
<a id="md:tx-helper" class="tsd-anchor"></a><h3><a href="#md:tx-helper">tx-helper</a></h3><p>The tx-helper package allows you to easily sign transactions. You just need the calldata and an implementation of the
<code>@polkadot-api/signer</code> interface.</p>
<a id="md:pjs-example-implementation" class="tsd-anchor"></a><h4><a href="#md:pjs-example-implementation">PJS Example Implementation</a></h4><pre><code class="language-ts"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">getLightClientProvider</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/web-page&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">connectInjectedExtension</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@polkadot-api/pjs-signer&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">fromHex</span><span class="hl-1">, </span><span class="hl-6">toHex</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@polkadot-api/utils&quot;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">createTx</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@substrate/light-client-extension-helpers/tx-helper&quot;</span><span class="hl-1"> </span><span class="hl-7">// ðŸ‘ˆ create-tx import</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">CHANNEL_ID</span><span class="hl-1"> = </span><span class="hl-2">&quot;...&quot;</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">lightClientProvider</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">getLightClientProvider</span><span class="hl-1">(</span><span class="hl-4">CHANNEL_ID</span><span class="hl-1">)</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">createTx</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-6">chainId</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-6">from</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-6">callData</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">chains</span><span class="hl-1"> = </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-0">values</span><span class="hl-1">(</span><span class="hl-6">lightClientProvider</span><span class="hl-1">.</span><span class="hl-0">getChains</span><span class="hl-1">())</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">chain</span><span class="hl-1"> = </span><span class="hl-6">chains</span><span class="hl-1">.</span><span class="hl-0">find</span><span class="hl-1">(({ </span><span class="hl-6">genesisHash</span><span class="hl-1"> }) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-6">genesisHash</span><span class="hl-1"> === </span><span class="hl-6">chainId</span><span class="hl-1">)</span><br/><br/><span class="hl-1">  </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-6">chain</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;unknown chain&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">injectedExt</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">connectInjectedExtension</span><span class="hl-1">(</span><span class="hl-2">&quot;polkadot-js&quot;</span><span class="hl-1">)</span><br/><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">account</span><span class="hl-1"> = </span><span class="hl-6">injectedExt</span><br/><span class="hl-1">    .</span><span class="hl-0">getAccounts</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">find</span><span class="hl-1">((</span><span class="hl-6">account</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">toHex</span><span class="hl-1">(</span><span class="hl-6">account</span><span class="hl-1">.</span><span class="hl-6">polkadotSigner</span><span class="hl-1">.</span><span class="hl-6">publicKey</span><span class="hl-1">) === </span><span class="hl-6">from</span><span class="hl-1">)</span><br/><br/><span class="hl-1">  </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-6">account</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;no account&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">signer</span><span class="hl-1"> = </span><span class="hl-6">account</span><span class="hl-1">.</span><span class="hl-6">polkadotSigner</span><span class="hl-1"> </span><span class="hl-7">// ðŸ‘ˆ @polkadot-api/signer implementation</span><br/><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">tx</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">createTx</span><span class="hl-1">(</span><span class="hl-6">chain</span><span class="hl-1">.</span><span class="hl-6">connect</span><span class="hl-1">)({</span><br/><span class="hl-1">    </span><span class="hl-6">callData:</span><span class="hl-1"> </span><span class="hl-0">fromHex</span><span class="hl-1">(</span><span class="hl-6">callData</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-6">signer</span><span class="hl-1">,</span><br/><span class="hl-1">  })</span><br/><br/><span class="hl-1">  </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-0">toHex</span><span class="hl-1">(</span><span class="hl-6">tx</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
</section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:components"><span>Components</span></a><a href="#md:example-usage"><span>Example <wbr/>Usage</span></a><ul><li><a href="#md:backgroundhelper"><span>background<wbr/>Helper</span></a></li><li><ul><li><a href="#md:how-you-can-use-it"><span>How <wbr/>You <wbr/>Can <wbr/>Use <wbr/>It</span></a></li></ul></li><li><a href="#md:contentscripthelper"><span>content<wbr/>Script<wbr/>Helper</span></a></li><li><ul><li><a href="#md:how-you-can-use-it-1"><span>How <wbr/>You <wbr/>Can <wbr/>Use <wbr/>It</span></a></li></ul></li><li><a href="#md:webpagehelper"><span>web<wbr/>Page<wbr/>Helper</span></a></li><li><ul><li><a href="#md:how-you-can-use-it-2"><span>How <wbr/>You <wbr/>Can <wbr/>Use <wbr/>It</span></a></li></ul></li><li><a href="#md:extensionpageshelper"><span>extension<wbr/>Pages<wbr/>Helper</span></a></li><li><ul><li><a href="#md:how-you-can-use-it-3"><span>How <wbr/>You <wbr/>Can <wbr/>Use <wbr/>It</span></a></li></ul></li><li><a href="#md:smoldot"><span>smoldot</span></a></li><li><ul><li><a href="#md:how-you-can-use-it-4"><span>How <wbr/>You <wbr/>Can <wbr/>Use <wbr/>It</span></a></li></ul></li><li><a href="#md:tx-helper"><span>tx-<wbr/>helper</span></a></li><li><ul><li><a href="#md:pjs-example-implementation"><span>PJS <wbr/>Example <wbr/>Implementation</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../index.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>Substrate Connect</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>